<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Diet wallah</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <img class="logo" src="logo.png" alt="Diet wallah logo" />
        <div class="brand-text">
          <h1>Diet wallah</h1>
          <p>Smart diet planner for Indian and Asian meals</p>
        </div>
      </div>
      <div class="header-note">
        Public calculator. No login. Runs fully in your browser.
      </div>
    </header>

    <main class="container">
      <section class="card">
        <h2>Body details</h2>
        <form id="planner-form">
          <div class="grid two">
            <label>
              Age (years)
              <input id="age" type="number" min="12" max="90" value="28" />
            </label>
            <label>
              Sex
              <select id="sex">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </label>
            <label>
              Height (cm)
              <input id="height" type="number" min="120" max="220" value="170" />
            </label>
            <label>
              Weight (kg)
              <input id="weight" type="number" min="30" max="200" value="70" />
            </label>
            <label>
              Activity level
              <select id="activity">
                <option value="1.2">Sedentary (desk job)</option>
                <option value="1.375">Light (1-3 days/week)</option>
                <option value="1.55" selected>Moderate (3-5 days/week)</option>
                <option value="1.725">Active (6-7 days/week)</option>
                <option value="1.9">Athlete (2x day)</option>
              </select>
            </label>
            <label>
              Goal
              <select id="goal">
                <option value="cut">Lose fat</option>
                <option value="maintain" selected>Maintain</option>
                <option value="bulk">Lean bulk</option>
              </select>
            </label>
          </div>

          <h3>Preferences</h3>
          <div class="grid two">
            <label>
              Diet type
              <select id="diet">
                <option value="veg">Veg</option>
                <option value="egg">Egg</option>
                <option value="non-veg" selected>Non-veg</option>
              </select>
            </label>
            <label>
              Cuisine focus
              <select id="cuisine">
                <option value="indian">Indian</option>
                <option value="asian">Asian</option>
                <option value="mixed" selected>Mixed</option>
                <option value="any">Any</option>
              </select>
            </label>
          </div>

          <div class="allergy-box">
            <span class="section-label">Allergies (checkboxes)</span>
            <div class="grid three">
              <label class="check">
                <input type="checkbox" value="milk" class="allergy" />
                Milk
              </label>
              <label class="check">
                <input type="checkbox" value="eggs" class="allergy" />
                Eggs
              </label>
              <label class="check">
                <input type="checkbox" value="peanuts" class="allergy" />
                Peanuts
              </label>
              <label class="check">
                <input type="checkbox" value="gluten" class="allergy" />
                Gluten
              </label>
              <label class="check">
                <input type="checkbox" value="soy" class="allergy" />
                Soy
              </label>
              <label class="check">
                <input type="checkbox" value="shellfish" class="allergy" />
                Shellfish
              </label>
            </div>
          </div>

          <label class="avoid">
            Foods to avoid (comma separated)
            <input id="avoid" type="text" placeholder="e.g. paneer, tofu, mushroom" />
          </label>

          <h3>Macro targets</h3>
          <div class="grid three">
            <label>
              Protein (g per kg)
              <input id="proteinKg" type="number" min="1" max="3" step="0.1" value="1.6" />
            </label>
            <label>
              Fat (g per kg)
              <input id="fatKg" type="number" min="0.4" max="1.2" step="0.1" value="0.8" />
            </label>
            <label>
              Meal timing
              <select id="timing">
                <option value="3">3 meals</option>
                <option value="4" selected>3 meals + 1 snack</option>
                <option value="5">3 meals + 2 snacks</option>
              </select>
            </label>
          </div>

          <div class="actions">
            <button type="submit">Generate 7-day plan</button>
            <button type="button" id="reset">Reset</button>
          </div>
        </form>
      </section>

      <section class="card results">
        <h2>Your results</h2>
        <div class="grid three">
          <div class="metric">
            <span class="label">TDEE</span>
            <span id="tdee">0</span>
          </div>
          <div class="metric">
            <span class="label">Goal calories</span>
            <span id="goalCalories">0</span>
          </div>
          <div class="metric">
            <span class="label">Daily water</span>
            <span id="water">0</span>
          </div>
        </div>

        <div class="macro-grid">
          <div class="macro">
            <span class="label">Protein</span>
            <span id="proteinGrams">0 g</span>
          </div>
          <div class="macro">
            <span class="label">Carbs</span>
            <span id="carbGrams">0 g</span>
          </div>
          <div class="macro">
            <span class="label">Fats</span>
            <span id="fatGrams">0 g</span>
          </div>
        </div>

        <div class="output-grid">
          <div>
            <h3>7-day meal plan</h3>
            <div id="mealPlan" class="meal-plan"></div>
          </div>
          <div>
            <h3>Grocery list</h3>
            <ul id="groceryList" class="grocery-list"></ul>
            <h3>Training tips</h3>
            <ul id="trainingTips" class="tips"></ul>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>
        This tool provides general fitness and nutrition guidance, not medical
        advice. If you are under 18, pregnant, or have a medical condition, talk
        to a qualified professional.
      </p>
    </footer>

    <script>
      const meals = [
        {
          name: "Poha with peanuts",
          mealType: "breakfast",
          diet: "veg",
          cuisine: "indian",
          allergens: ["peanuts"],
          ingredients: ["poha", "onion", "peas", "peanuts", "lemon"]
        },
        {
          name: "Idli with sambar",
          mealType: "breakfast",
          diet: "veg",
          cuisine: "indian",
          allergens: ["gluten"],
          ingredients: ["idli batter", "sambar", "coconut chutney"]
        },
        {
          name: "Masala omelette",
          mealType: "breakfast",
          diet: "egg",
          cuisine: "indian",
          allergens: ["eggs"],
          ingredients: ["eggs", "onion", "tomato", "spices"]
        },
        {
          name: "Moong dal chilla",
          mealType: "breakfast",
          diet: "veg",
          cuisine: "indian",
          allergens: [],
          ingredients: ["moong dal", "green chili", "coriander"]
        },
        {
          name: "Chicken congee",
          mealType: "breakfast",
          diet: "non-veg",
          cuisine: "asian",
          allergens: ["soy"],
          ingredients: ["rice", "chicken", "ginger", "soy sauce"]
        },
        {
          name: "Vegetable upma",
          mealType: "breakfast",
          diet: "veg",
          cuisine: "indian",
          allergens: ["gluten"],
          ingredients: ["semolina", "carrot", "beans", "mustard seeds"]
        },
        {
          name: "Tofu veggie scramble",
          mealType: "breakfast",
          diet: "veg",
          cuisine: "asian",
          allergens: ["soy"],
          ingredients: ["tofu", "bell pepper", "spinach"]
        },
        {
          name: "Rajma chawal",
          mealType: "lunch",
          diet: "veg",
          cuisine: "indian",
          allergens: [],
          ingredients: ["rajma", "rice", "tomato", "onion"]
        },
        {
          name: "Dal tadka with roti",
          mealType: "lunch",
          diet: "veg",
          cuisine: "indian",
          allergens: ["gluten"],
          ingredients: ["toor dal", "roti", "ghee", "spices"]
        },
        {
          name: "Grilled chicken with brown rice",
          mealType: "lunch",
          diet: "non-veg",
          cuisine: "asian",
          allergens: [],
          ingredients: ["chicken", "brown rice", "salad"]
        },
        {
          name: "Fish curry with rice",
          mealType: "lunch",
          diet: "non-veg",
          cuisine: "indian",
          allergens: ["shellfish"],
          ingredients: ["fish", "rice", "coconut milk", "spices"]
        },
        {
          name: "Paneer bhurji with roti",
          mealType: "lunch",
          diet: "veg",
          cuisine: "indian",
          allergens: ["milk", "gluten"],
          ingredients: ["paneer", "roti", "onion", "tomato"]
        },
        {
          name: "Stir fried tofu and veggies",
          mealType: "lunch",
          diet: "veg",
          cuisine: "asian",
          allergens: ["soy"],
          ingredients: ["tofu", "broccoli", "carrot", "soy sauce"]
        },
        {
          name: "Chickpea salad bowl",
          mealType: "lunch",
          diet: "veg",
          cuisine: "mixed",
          allergens: [],
          ingredients: ["chickpeas", "lettuce", "tomato", "olive oil"]
        },
        {
          name: "Khichdi with curd",
          mealType: "dinner",
          diet: "veg",
          cuisine: "indian",
          allergens: ["milk"],
          ingredients: ["rice", "moong dal", "curd"]
        },
        {
          name: "Egg fried rice",
          mealType: "dinner",
          diet: "egg",
          cuisine: "asian",
          allergens: ["eggs", "soy"],
          ingredients: ["rice", "eggs", "soy sauce", "vegetables"]
        },
        {
          name: "Chicken stir fry",
          mealType: "dinner",
          diet: "non-veg",
          cuisine: "asian",
          allergens: ["soy"],
          ingredients: ["chicken", "bell pepper", "soy sauce"]
        },
        {
          name: "Palak paneer with rice",
          mealType: "dinner",
          diet: "veg",
          cuisine: "indian",
          allergens: ["milk"],
          ingredients: ["spinach", "paneer", "rice"]
        },
        {
          name: "Miso soup with soba",
          mealType: "dinner",
          diet: "veg",
          cuisine: "asian",
          allergens: ["soy", "gluten"],
          ingredients: ["miso", "soba", "mushroom"]
        },
        {
          name: "Chicken tikka with salad",
          mealType: "dinner",
          diet: "non-veg",
          cuisine: "indian",
          allergens: ["milk"],
          ingredients: ["chicken", "yogurt", "salad"]
        },
        {
          name: "Mixed nuts snack",
          mealType: "snack",
          diet: "veg",
          cuisine: "mixed",
          allergens: ["peanuts"],
          ingredients: ["almonds", "walnuts", "peanuts"]
        },
        {
          name: "Fruit bowl",
          mealType: "snack",
          diet: "veg",
          cuisine: "mixed",
          allergens: [],
          ingredients: ["banana", "apple", "papaya"]
        },
        {
          name: "Greek yogurt",
          mealType: "snack",
          diet: "veg",
          cuisine: "mixed",
          allergens: ["milk"],
          ingredients: ["yogurt", "berries"]
        },
        {
          name: "Boiled eggs",
          mealType: "snack",
          diet: "egg",
          cuisine: "mixed",
          allergens: ["eggs"],
          ingredients: ["eggs", "black pepper"]
        },
        {
          name: "Chicken soup",
          mealType: "snack",
          diet: "non-veg",
          cuisine: "asian",
          allergens: [],
          ingredients: ["chicken", "carrot", "celery"]
        }
      ];

      const tips = [
        "Aim for 7-8 hours of sleep to support recovery.",
        "Do 2-3 strength sessions weekly for lean mass.",
        "Add a 20-30 minute walk after meals for digestion.",
        "Keep protein spread across meals."
      ];

      const form = document.getElementById("planner-form");
      const resetButton = document.getElementById("reset");
      const tdeeEl = document.getElementById("tdee");
      const goalCaloriesEl = document.getElementById("goalCalories");
      const waterEl = document.getElementById("water");
      const proteinEl = document.getElementById("proteinGrams");
      const carbsEl = document.getElementById("carbGrams");
      const fatEl = document.getElementById("fatGrams");
      const mealPlanEl = document.getElementById("mealPlan");
      const groceryListEl = document.getElementById("groceryList");
      const tipsEl = document.getElementById("trainingTips");

      function getCheckedAllergies() {
        return Array.from(document.querySelectorAll(".allergy"))
          .filter((input) => input.checked)
          .map((input) => input.value);
      }

      function parseAvoidList(value) {
        return value
          .split(",")
          .map((item) => item.trim().toLowerCase())
          .filter(Boolean);
      }

      function calculate() {
        const age = Number(document.getElementById("age").value);
        const sex = document.getElementById("sex").value;
        const height = Number(document.getElementById("height").value);
        const weight = Number(document.getElementById("weight").value);
        const activity = Number(document.getElementById("activity").value);
        const goal = document.getElementById("goal").value;
        const proteinKg = Number(document.getElementById("proteinKg").value);
        const fatKg = Number(document.getElementById("fatKg").value);

        const bmr =
          sex === "male"
            ? 10 * weight + 6.25 * height - 5 * age + 5
            : 10 * weight + 6.25 * height - 5 * age - 161;
        const tdee = Math.round(bmr * activity);
        const goalDelta = goal === "cut" ? -500 : goal === "bulk" ? 300 : 0;
        const goalCalories = Math.max(1200, tdee + goalDelta);

        const proteinGrams = Math.round(weight * proteinKg);
        const fatGrams = Math.round(weight * fatKg);
        const proteinCals = proteinGrams * 4;
        const fatCals = fatGrams * 9;
        const remainingCals = Math.max(0, goalCalories - proteinCals - fatCals);
        const carbGrams = Math.round(remainingCals / 4);

        tdeeEl.textContent = `${tdee} kcal`;
        goalCaloriesEl.textContent = `${goalCalories} kcal`;
        waterEl.textContent = `${Math.round(weight * 33)} ml`;
        proteinEl.textContent = `${proteinGrams} g`;
        carbsEl.textContent = `${carbGrams} g`;
        fatEl.textContent = `${fatGrams} g`;

        return { goalCalories, proteinGrams, carbGrams, fatGrams };
      }

      function filterMeals() {
        const diet = document.getElementById("diet").value;
        const cuisine = document.getElementById("cuisine").value;
        const allergies = getCheckedAllergies();
        const avoidList = parseAvoidList(document.getElementById("avoid").value);

        return meals.filter((meal) => {
          const dietOk =
            diet === "veg"
              ? meal.diet === "veg"
              : diet === "egg"
              ? meal.diet === "veg" || meal.diet === "egg"
              : true;
          const cuisineOk =
            cuisine === "any" || cuisine === "mixed"
              ? true
              : meal.cuisine === cuisine;
          const allergyOk = !allergies.some((item) => meal.allergens.includes(item));
          const avoidOk = !avoidList.some((word) =>
            meal.name.toLowerCase().includes(word)
          );
          return dietOk && cuisineOk && allergyOk && avoidOk;
        });
      }

      function pickMeals(filtered, type, count) {
        const items = filtered.filter((meal) => meal.mealType === type);
        if (!items.length) return [];
        const selected = [];
        for (let i = 0; i < count; i += 1) {
          selected.push(items[i % items.length]);
        }
        return selected;
      }

      function buildPlan() {
        const filtered = filterMeals();
        const timing = Number(document.getElementById("timing").value);
        const includeSnack = timing >= 4;
        const includeSnack2 = timing === 5;
        const grocery = new Set();
        const planHtml = [];

        for (let day = 1; day <= 7; day += 1) {
          const breakfast = pickMeals(filtered, "breakfast", 7)[day - 1];
          const lunch = pickMeals(filtered, "lunch", 7)[day - 1];
          const dinner = pickMeals(filtered, "dinner", 7)[day - 1];
          const snack = includeSnack ? pickMeals(filtered, "snack", 7)[day - 1] : null;
          const snack2 = includeSnack2
            ? pickMeals(filtered, "snack", 7)[(day + 1) % 7]
            : null;

          const mealsForDay = [breakfast, lunch, dinner, snack, snack2].filter(Boolean);
          mealsForDay.forEach((meal) => {
            meal.ingredients.forEach((item) => grocery.add(item));
          });

          planHtml.push(
            `<div class="day"><h4>Day ${day}</h4>` +
              `<p><strong>Breakfast:</strong> ${breakfast ? breakfast.name : "Chef choice"}</p>` +
              `<p><strong>Lunch:</strong> ${lunch ? lunch.name : "Chef choice"}</p>` +
              `<p><strong>Dinner:</strong> ${dinner ? dinner.name : "Chef choice"}</p>` +
              (snack ? `<p><strong>Snack:</strong> ${snack.name}</p>` : "") +
              (snack2 ? `<p><strong>Snack 2:</strong> ${snack2.name}</p>` : "") +
              `</div>`
          );
        }

        mealPlanEl.innerHTML = planHtml.join("");

        groceryListEl.innerHTML = "";
        Array.from(grocery)
          .sort()
          .forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            groceryListEl.appendChild(li);
          });

        tipsEl.innerHTML = "";
        tips.forEach((tip) => {
          const li = document.createElement("li");
          li.textContent = tip;
          tipsEl.appendChild(li);
        });
      }

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        calculate();
        buildPlan();
      });

      resetButton.addEventListener("click", () => {
        form.reset();
        calculate();
        buildPlan();
      });

      calculate();
      buildPlan();
    </script>
  </body>
</html>